LAB_NAME="imovies_ca"
LAB_DESCRIPTION="iMovies CA Authority"
LAB_VERSION=1.0

# ===================================
# Network Infrastructure Setup
# ===================================

edge_router01[0]="internet"
edge_router01[1]="dmz"
edge_router01[image]="kathara/frr"    
edge_router01[sysctl]="net.ipv4.ip_forward=1"
# edge_router01[bridged]="true"

core_router01[0]="dmz"
core_router01[1]="prod"
core_router01[2]="data"
core_router01[3]="mgmt"
core_router01[image]="kathara/frr" 
core_router01[sysctl]="net.ipv4.ip_forward=1"
# core_router01[bridged]="true"

# ===================================
# External Client Setup
# ===================================

ext_client01[0]="internet"
ext_client01[bridged]="true"
ext_client01[image]="imovies/client"
ext_client01[env]="VNC_RESOLUTION=1920x1080"
ext_client01[env]="STARTING_WEBSITE_URL=https://portal.imovies.lan"
ext_client01[port]="6080:6080"
ext_client01[port]="5900:5900"

# ===================================
# DMZ Setup
# ===================================

dmz_rp01[0]="dmz"
dmz_rp01[image]="imovies/nginx"
dmz_rp01[env]="VAULT_ADDR=https://vault.imovies.lan:8200"

# ===================================
# Vault Setup
# ===================================

mgmt_vault01[0]="mgmt"
mgmt_vault01[image]="imovies/vault"
mgmt_vault01[env]="VAULT_API_ADDR=https://vault.imovies.lan:8200"
mgmt_vault01[env]="VAULT_ADDR=https://vault.imovies.lan:8200"
mgmt_vault01[env]="VAULT_CACERT=/vault/userconfig/tls/ca.crt"
mgmt_vault01[volume]="./vault_data/data|/vault/data|rw"
# ===================================
# DB Setup
# ===================================

# imovies db
data_db01[0]="data"
data_db01[image]="imovies/mysql"
data_db01[env]="MYSQL_ROOT_PASSWORD=preseason-roving-overvalue-swipe-resilient-elongated"
data_db01[env]="MYSQL_DATABASE=imovies"
data_db01[volume]="./imovies_data|/var/lib/mysql|rw"

# guacamole db
data_db02[0]="data"
data_db02[image]="imovies/mysql"
data_db02[env]="MYSQL_USER=guacamole_user"
data_db02[env]="MYSQL_PASSWORD=treadmill-fox-garbage-divorcee-iodine-nullify"
data_db02[env]="MYSQL_ROOT_PASSWORD=treadmill-fox-garbage-divorcee-iodine-nullify"
data_db02[env]="MYSQL_DATABASE=guacamole_db"
data_db02[volume]="./guac_data|/var/lib/mysql|rw"

# ===================================
# Portal Setup
# ===================================

prod_web01[0]="prod"
prod_web01[image]="imovies/portal"
prod_web01[env]="VAULT_ADDR=https://vault.imovies.lan:8200"
prod_web01[env]="VAULT_CACERT=/srv/app/ca.crt"
prod_web01[env]="DB_HOST=10.50.30.2"
prod_web01[env]="DB_NAME=imovies"
prod_web01[env]="DB_VAULT_ROLE=imovies_app"

# ===================================
# Wazuh Kathara Setup (based on https://github.com/g4br-i/KathaRange)
# ===================================

# Wazuh Indexer
mgmt_w_indexer01[0]="mgmt"
mgmt_w_indexer01[image]="imovies/wazuh:indexer"
mgmt_w_indexer01[env]="OPENSEARCH_JAVA_OPTS=-Xms1g -Xmx1g"
mgmt_w_indexer01[env]="INDEXER_IP=10.50.40.11"
mgmt_w_indexer01[env]="MANAGER_IP=10.50.40.10"
mgmt_w_indexer01[bridged]=true
mgmt_w_indexer01[ulimit]="memlock=-1:-1"
mgmt_w_indexer01[ulimit]="nofile=65536:65536"

# Wazuh Manager
mgmt_w_manager01[0]="mgmt"
mgmt_w_manager01[image]="imovies/wazuh:manager"
mgmt_w_manager01[env]="INDEXER_URL=https://wazuh.indexer:9200"
mgmt_w_manager01[env]="INDEXER_USERNAME=admin"
mgmt_w_manager01[env]="INDEXER_PASSWORD=SecretPassword"
mgmt_w_manager01[env]="FILEBEAT_SSL_VERIFICATION_MODE=full"
mgmt_w_manager01[env]="SSL_CERTIFICATE_AUTHORITIES=/etc/ssl/root-ca.pem"
mgmt_w_manager01[env]="SSL_CERTIFICATE=/etc/ssl/filebeat.pem"
mgmt_w_manager01[env]="SSL_KEY=/etc/ssl/filebeat.key"
mgmt_w_manager01[env]="API_USERNAME=wazuh-wui"
mgmt_w_manager01[env]="API_PASSWORD=MyS3cr37P450r.*-"
mgmt_w_manager01[env]="INDEXER_IP=10.50.40.11"
mgmt_w_manager01[env]="MANAGER_IP=10.50.40.10"
mgmt_w_manager01[bridged]=true
mgmt_w_manager01[ulimit]="memlock=-1:-1"
mgmt_w_manager01[ulimit]="nofile=655360:655360"

# Wazuh Dashboard
prod_w_dashboard01[0]="prod"
prod_w_dashboard01[image]="imovies/wazuh:dashboard"
prod_w_dashboard01[env]="INDEXER_USERNAME=admin"
prod_w_dashboard01[env]="INDEXER_PASSWORD=SecretPassword"
prod_w_dashboard01[env]="SERVER_SSL_ENABLED=false"
prod_w_dashboard01[env]="WAZUH_API_URL=https://wazuh.manager"
prod_w_dashboard01[env]="DASHBOARD_USERNAME=kibanaserver"
prod_w_dashboard01[env]="DASHBOARD_PASSWORD=kibanaserver"
prod_w_dashboard01[env]="API_USERNAME=wazuh-wui"
prod_w_dashboard01[env]="API_PASSWORD=MyS3cr37P450r.*-"
prod_w_dashboard01[env]="INDEXER_IP=10.50.40.11"
prod_w_dashboard01[env]="MANAGER_IP=10.50.40.10"
prod_w_dashboard01[bridged]=true
prod_w_dashboard01[port]="5601:5601/tcp"

# ===================================
# Backup Server Setup
# ===================================

mgmt_bkp_local01[0]="mgmt"
mgmt_bkp_local01[image]="imovies/backup"
mgmt_bkp_local01[env]="SSH_KEY_PATH=/backup/ssh/id_rsa"
mgmt_bkp_local01[volume]="./backup_local_data|/backup/|rw"

offsite_bkp_offsite01[0]="offsite"
offsite_bkp_offsite01[image]="imovies/backup"
offsite_bkp_offsite01[volume]="./backup_offsite_data|/backup/|rw"

# ===================================
# Guacamole Setup
# ===================================

mgmt_guac_guacd01[0]="mgmt"
mgmt_guac_guacd01[image]="imovies/guacd"
# mgmt_guac_guacd01[bridged]=true
# mgmt_guac_guacd01[port]="4822:4822/tcp"

prod_guac_web01[0]="prod"
prod_guac_web01[image]="imovies/guacamole"
prod_guac_web01[bridged]=true
prod_guac_web01[port]="8080:8080/tcp"
prod_guac_web01[env]="LOG_LEVEL=debug"
prod_guac_web01[env]="MYSQL_ENABLED=true"
prod_guac_web01[env]="MYSQL_DATABASE=guacamole_db"
prod_guac_web01[env]="MYSQL_USERNAME=guacamole_user"
prod_guac_web01[env]="MYSQL_PASSWORD=treadmill-fox-garbage-divorcee-iodine-nullify"
prod_guac_web01[env]="MYSQL_HOSTNAME=10.50.30.3"
prod_guac_web01[env]="MYSQL_TRACK_EXTERNAL_CONNECTION_HISTORY=false"
prod_guac_web01[env]="GUACD_HOSTNAME=10.50.40.20"
prod_guac_web01[env]="SSL_AUTH_ENABLED=true"
prod_guac_web01[env]="SSL_AUTH_URI=https://*.auth.guac.imovies.lan/guacamole"
prod_guac_web01[env]="SSL_AUTH_PRIMARY_URI=https://guac.imovies.lan/guacamole"
prod_guac_web01[env]="SSL_AUTH_SUBJECT_USERNAME_ATTRIBUTE=CN"